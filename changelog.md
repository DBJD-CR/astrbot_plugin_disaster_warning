# 灾害预警插件更新日志 (Changelog)

## [v2.4.0] - 2025-12-21
### 新增功能
- **精细化推送配置**：支持为每个数据源单独配置推送目标（群组和用户）
- **独立WebUI系统**：重写HTTP服务器，提供完整的Web配置界面
- **实时状态监控**：新增服务状态监控面板，实时显示连接状态和运行信息
- **数据源动态配置**：从后端API动态获取数据源列表，支持所有16个数据源

### 功能改进
- **WebUI增强**：修复配置加载问题，增强JavaScript错误处理
- **会话格式修复**：将私聊消息类型从`PrivateMessage`更正为`FriendMessage`
- **错误处理优化**：增强所有组件的错误处理和容错机制
- **性能优化**：改进数据加载和渲染性能

### 修复问题
- 修复WebUI无法读取之前配置信息的问题
- 修复消息推送会话格式不匹配的问题
- 修复独立WebUI无效的问题
- 修复数据源配置加载失败的问题

---

## [v2.3.0] - 2025-12-20
### 新增功能
- **多数据源支持**：新增支持多达16个可自由选择启用的细粒度数据源
  - FAN Studio 综合源（中国地震网、台湾气象署、USGS、气象预警、海啸预警等）
  - P2P地震情報 WebSocket（日本紧急地震速报、地震情报、海啸预报）
  - Wolfx API（多国家地震预警和地震列表）
  - Global Quake 实时测算服务
- **智能推送控制**：基于震级、烈度、震度设置推送阈值，支持频率控制
- **本地预估烈度**：基于用户位置计算本地烈度影响
- **高级过滤器**：多种过滤器支持，包括烈度过滤、震度过滤、USGS过滤等
- **事件去重功能**：防止同一地震事件被重复推送
- **卡片渲染功能**：基于Playwright的高性能图片渲染引擎

### 架构改进
- **模块化设计**：重构为模块化、松耦合的工业级架构
- **异步架构**：完全基于asyncio异步框架构建
- **数据规范化**：统一抽象层，将异构数据转换为标准模型
- **智能去重矩阵**：复杂模糊匹配指纹算法
- **自愈型连接管理器**：支持主备服务器切换和指数退避重连

---

## [v2.2.0] - 2025-12-19
### 新增功能
- **多平台支持**：支持多种消息平台（如aiocqhttp等）
- **命令系统**：新增丰富的管理命令
  - `/灾害预警` - 显示帮助信息
  - `/灾害预警状态` - 查看服务运行状态
  - `/灾害预警统计` - 查看事件统计报告
  - `/灾害预警测试` - 测试推送功能
  - `/灾害预警模拟` - 模拟地震事件测试
  - `/灾害预警配置` - 查看配置信息
- **统计功能**：详细的事件统计和分析报告
- **日志记录**：原始消息记录功能，支持格式化输出

### 功能改进
- **配置管理**：支持WebUI配置界面
- **过滤器增强**：多种过滤器支持不同数据源特性
- **错误处理**：完善的错误处理和日志记录

---

## [v2.1.0] - 2025-12-18
### 新增功能
- **WebSocket连接管理**：支持多服务器连接，主备切换
- **数据处理器**：支持多种数据源格式解析
- **消息格式化**：多种消息格式化器，支持地图链接
- **报数控制**：支持EEW数据源的报数控制功能

### 功能改进
- **连接稳定性**：改进重连机制和心跳监测
- **数据处理**：优化数据解析和处理逻辑
- **推送机制**：改进消息推送和过滤机制

---

## [v2.0.0] - 2025-12-17
### 重大更新
- **全面重构**：从单一文件重构为模块化架构
- **新架构**：引入HandlerRegistry、EventDeduplicator等核心组件
- **数据源扩展**：支持多种国际数据源
- **过滤系统**：完整的过滤器系统，支持多维度过滤

---

## [v1.0.0] - 2025-12-16
### 初始版本
- **基础功能**：实现灾害预警插件基础功能
- **数据源**：支持基础地震数据源
- **推送功能**：基础消息推送功能
- **配置系统**：基础配置管理功能